{
    "collab_server" : "",
    "contents" : "#################### Librerías #############################################\nrm(list=ls())\npacman::p_load(readxl,readr,dplyr,ggplot2)\nsource(\"Funciones.R\")\n\n#################### Archivos #############################################\n\nread_excel(\"Accesibilidad.xls\")%>% \n  mutate(COMUNA=toupper(COMUNA))%>%\n  mutate(COMUNA=chartr(\"ÁÉÍÓÚ\",\"AEIOU\",COMUNA))->Accesibilidad\n\nread_csv(\"UbicacionGeografica2016.csv\")%>%filter(ENS_01==110 | ENS_01==310 |\n                                                   ENS_02==110 | ENS_02==310 |\n                                                   ENS_03==110 | ENS_03==310 |\n                                                   ENS_04==110 | ENS_04==310 |\n                                                   ENS_05==110 | ENS_05==310 |\n                                                   ENS_06==110 | ENS_06==310 |\n                                                   ENS_07==110 | ENS_07==310 |\n                                                   ENS_08==110 | ENS_08==310 |\n                                                   ENS_09==110 | ENS_09==310 \n                                                 )%>% filter(ESTADO_ESTAB==1)%>%\n  mutate(NOM_COM_RBD=chartr(\"ÁÉÍÓÚ\",\"AEIOU\",NOM_COM_RBD))%>%\n  left_join(Accesibilidad,by=c(\"NOM_COM_RBD\" = \"COMUNA\"))%>%\n   select(RBD,NOM_RBD,\n         MRUN,RUT_SOSTENEDOR,\n         P_JURIDICA,COD_REG_RBD,\n         COD_COM_RBD,NOM_COM_RBD,\n         COD_DEPE, COD_DEPE2,\n         RURAL_RBD,CONVENIO_PIE,\n         LATITUD,LONGITUD,\n         ORI_RELIGIOSA,PAGO_MATRICULA,\n         PAGO_MENSUAL,GRADO_ACCESIBILIDAD,\n         NOMBRE_ACCESIBILIDAD,NECESIDAD_AVION)->UbicacionGeografica2016\n\nColegios_Puntaje_2012 <-\n  read_excel(\"Colegios.xls\", sheet = \"SIMCE IIM 2012 Leng\")\n\n\nread_excel(\"VistaResumenMatriculaEE2016.xlsx\") %>% \n  select(RBD, COD_DEPE, COD_DEPE2, MAT_TOTAL) ->\n  Colegios_Mat_Total\nView(Colegios_Mat_Total)\n\nColegios_Lideres <- read_excel(\"base datos redes final.xlsx\")\n\nColegios_Redes <- read_excel(\"base datos redes final.xlsx\", \n                                     sheet = \"Redes\")\n\n## Regla de tres para calcular la SEP ###\n## Valor USE 25385 ###\n## Tomando 0.70575 USE EMERGENTE o RECUPERACION ###\n##         1.4115  USE AUTONOMO ###\n\nread_excel(\"VistaresumenprioritariospreferentesybeneficiariosSEPporEE2016.xlsx\") %>%\n  filter(CONVENIO_SEP == \"1\") %>% mutate(\n    monto = ifelse(\n      CLASIFICACION_SEP == \"AUTONOMO\",\n      1.4115 * 25385 * as.numeric(N_BEN),\n      0.70575 * 25385 * as.numeric(N_BEN)\n    )\n  ) %>% select(RBD, N_BEN, monto) -> Colegios_Ley_SEP;\nView(Colegios_Ley_SEP)\n\n\nDim_Servicios <- read_excel(\"Data_Ejemplo.xlsx\", \n                            sheet = \"DIM Servicios\", col_types = c(\"text\", \n                                                                   \"text\", \"numeric\", \"numeric\", \"numeric\", \n                                                                   \"numeric\", \"numeric\", \"numeric\", \n                                                                   \"numeric\", \"numeric\", \"numeric\", \n                                                                   \"numeric\"))\n\nDim_asesor <- read_excel(\"Data_Ejemplo.xlsx\", \n                         sheet = \"Dim Asesor\", col_types = c(\"text\", \n                                                             \"numeric\", \"numeric\"))\n\n\n##################### Limpieza de Bases ################################################\n\n\n#### Unir Bases ###\n## PUNTAJE SIMCE\n# summary(UbicacionGeografica2016)\n# summary(Colegios_Ley_SEP)\nColegios_Mat_Total$RBD <- as.numeric(Colegios_Mat_Total$RBD)\nColegios_Ley_SEP$RBD <- as.numeric(Colegios_Ley_SEP$RBD)\nColegios_Ley_SEP$NUMERO_BENEFICIADOS <- as.numeric(Colegios_Ley_SEP$NUMERO_BENEFICIADOS)\nColegios_Ley_SEP$MONTO_SEP <- as.numeric(Colegios_Ley_SEP$MONTO_SEP)\n\ncolnames(Colegios_Ley_SEP) <-\n  c(\"RBD\", \"NUMERO_BENEFICIADOS\", \"MONTO_SEP\")\n\n\nUbicacionGeografica2016%>%\n  left_join(Colegios_Puntaje_2012,by=\"RBD\")%>%   # DATA PUNTAJE\n  left_join(Colegios_Mat_Total,by=\"RBD\")%>%      # DATA MATRICULAS\n  left_join(Colegios_Lideres,by=\"RBD\")%>%        # DATA COLEGIOS LIDERES\n  left_join(Colegios_Redes,by=\"RBD\")%>%          # DATA REDES DE COLEGIOS\n  left_join(Colegios_Ley_SEP,by=\"RBD\")%>%        # COLEGIOS LEY SEP\n  mutate(\n    MONTO_SEP = ifelse(is.na(MONTO_SEP), 0, MONTO_SEP),\n    NUMERO_BENEFICIADOS = ifelse(is.na(NUMERO_BENEFICIADOS), 0, NUMERO_BENEFICIADOS),\n    RED_DE_ESCUELAS_LIDERES = ifelse(is.na(RED_DE_ESCUELAS_LIDERES), 0, RED_DE_ESCUELAS_LIDERES)\n  )%>%\n  rowwise() %>% mutate(DEPENDENCIA = switch_R(\n    condiciones = c(\n      COD_DEPE2.y == 1,\n      COD_DEPE2.y ==2,\n      COD_DEPE2.y == 3,\n      COD_DEPE2.y ==4),\n    consecuencias = c(\"Municipal\",\n                      \"Particular Subvencionado\",\n                      \"Particular Pagado\",\n                      \"Administración Delegada\",\n                      NA)))%>%\n  mutate(RURAL_RBD = switch_R(\n    condiciones = c(\n      RURAL_RBD == 1,\n      RURAL_RBD ==0),\n    consecuencias = c(\"RURAL\",\n                      \"URBANO\",\n                      NA)))%>%\n  mutate(ORI_RELIGIOSA = switch_R(\n    condiciones = c(\n      ORI_RELIGIOSA == 1,\n      ORI_RELIGIOSA == 2,\n      ORI_RELIGIOSA == 3,\n      ORI_RELIGIOSA == 4,\n      ORI_RELIGIOSA == 5,\n      ORI_RELIGIOSA == 6,\n      ORI_RELIGIOSA == 7,\n      ORI_RELIGIOSA == 8,\n      ORI_RELIGIOSA == 9),\n    consecuencias = c(\"Laica\",\n                      \"Católica\",\n                      \"Evangélica\",\n                      \"Musulmana\",\n                      \"Judía\",\n                      \"Budista\",\n                      \"Otro\",\n                      NA,\n                      NA,\n                      NA)))%>%\n    select(RBD,NOM_RBD,\n           MRUN,RUT_SOSTENEDOR,\n           COD_REG_RBD,COD_COM_RBD,NOM_COM_RBD,\n           DEPENDENCIA,\n           RURAL_RBD,CONVENIO_PIE,\n           LATITUD,LONGITUD,\n           ORI_RELIGIOSA,PAGO_MATRICULA,\n           PAGO_MENSUAL,NOMBRE_ACCESIBILIDAD,\n           NECESIDAD_AVION,\n           PROM_LECT,PROM_MAT,           # PROMEDIO NOTAS SIMCE 2012\n           MAT_TOTAL,                    # MATRICULAS TOTALES\n           RED_DE_ESCUELAS_LIDERES,      # COLEGIOS LIDERES\n           Grupo,                        # RED COLEGIOS\n           NUMERO_BENEFICIADOS,MONTO_SEP # COLEGIOS LEY SEP\n           )->Ubicacion_Actualizada; View(Ubicacion_Actualizada)\n\nnames(Ubicacion_Actualizada)%>%toupper()->names_data;\ngsub(\" \", \"\",chartr(\"ÁÉÍÓÚ\",\"AEIOU\",names_data) ,fixed = TRUE)->names(Ubicacion_Actualizada)\n\n\n############## Generación de variables agrupadas ####################\n\nungroup(Ubicacion_Actualizada)->Ubicacion_Actualizada\nUbicacion_Actualizada$NOM_COM_RBD<-as.factor(Ubicacion_Actualizada$NOM_COM_RBD)\nUbicacion_Actualizada$MAT_TOTAL<-as.numeric(Ubicacion_Actualizada$MAT_TOTAL)\n  \n##Matricula Por Comuna ###\nUbicacion_Actualizada %>%\n  group_by(NOM_COM_RBD) %>%\n  summarise(Matricula_Comuna = sum(MAT_TOTAL, na.rm = TRUE)) -> Mat_Comuna;View(Mat_Comuna)\n\n## Matrícula Por Sostenedor ##\nUbicacion_Actualizada%>%\n  group_by(RUT_SOSTENEDOR)%>%\n  summarise(Matricula_Sostenedor=sum(MAT_TOTAL,na.rm=TRUE))->Mat_Sostenedor;View(Mat_Sostenedor)\n\n## Agregar Matricula por Sostenedor a Base Principal\nUbicacion_Actualizada%>%\n  left_join(Colegios_Redes,by=\"RBD\")%>%\n  mutate(GRUPO=ifelse(is.na(GRUPO),RUT_SOSTENEDOR,GRUPO))%>%\n  group_by(GRUPO)%>%\n  summarise(Matricula_Grupo=sum(MAT_TOTAL,na.rm=TRUE))->Mat_Grupo\n\n\nUbicacion_Actualizada%>%\n  left_join(Colegios_Redes,by=\"RBD\")%>%\n  mutate(GRUPO=ifelse(is.na(GRUPO),RUT_SOSTENEDOR,GRUPO))->Ubicacion_Actualizada\n\nUbicacion_Actualizada%>%\n  left_join(filter(Mat_Comuna,!is.na(Matricula_Comuna)),by=\"NOM_COM_RBD\")%>%\n  left_join(Mat_Grupo,by=\"GRUPO\")->Ubicacion_Actualizada;\nUbicacion_Actualizada%>%View()    \n\n#### Agregar Grado Accesibilidad y necesidad de avion\n\n### Agregar Colegios ley  SEP\n\nUbicacion_Actualizada%>%\n  left_join(Colegios_Ley_SEP,by=\"RBD\")%>%View()  \n  # left_join(Mat_Grupo,by=\"Grupo\")->Ubicacion_Actualizada;\nUbicacion_Actualizada%>%View()    \n\n########################## Selección de variables a utilizar ###################################\nnames(Ubicacion_Actualizada)\n\nUbicacion_Actualizada%>%rowwise()%>%mutate(PAGO_MATRICULA_2=switch_R(condiciones=c(PAGO_MATRICULA==\"$1.000 A $10.000\",\n                                                                                   PAGO_MATRICULA==\"$10.001 A $25.000\",\n                                                                                   PAGO_MATRICULA==\"$25.001 A $50.000\",\n                                                                                   PAGO_MATRICULA==\"$50.001 A $100.000\",\n                                                                                   PAGO_MATRICULA==\"GRATUITO\",\n                                                                                   PAGO_MATRICULA==\"MAS DE $100.000\",\n                                                                                   PAGO_MATRICULA==\"SIN INFORMACION\")\n                                                                     ,consecuencias=c(5000,\n                                                                                      17500,\n                                                                                      37500,\n                                                                                      75000,\n                                                                                      0,\n                                                                                      100000,\n                                                                                      NA,\n                                                                                      NA)\n))->Ubicacion_Actualizada;Ubicacion_Actualizada%>%summary()\n\nUbicacion_Actualizada%>%rowwise()%>%mutate(PAGO_MENSUAL_2=switch_R(condiciones=c(PAGO_MENSUAL==\"$1.000 A $10.000\",\n                                                                                 PAGO_MENSUAL==\"$10.001 A $25.000\",\n                                                                                 PAGO_MENSUAL==\"$25.001 A $50.000\",\n                                                                                 PAGO_MENSUAL==\"$50.001 A $100.000\",\n                                                                                 PAGO_MENSUAL==\"GRATUITO\",\n                                                                                 PAGO_MENSUAL==\"MAS DE $100.000\",\n                                                                                 PAGO_MENSUAL==\"SIN INFORMACION\")\n                                                                     ,consecuencias=c(5000,\n                                                                                      17500,\n                                                                                      37500,\n                                                                                      75000,\n                                                                                      0,\n                                                                                      100000,\n                                                                                      NA,\n                                                                                      NA)\n))->Ubicacion_Actualizada;Ubicacion_Actualizada%>%summary()",
    "created" : 1508763558486.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1725122698",
    "id" : "4BA090D3",
    "lastKnownWriteTime" : 1508768621,
    "last_content_update" : 1508768621190,
    "path" : "C:/Users/César/Desktop/Clientes/Ziemax/Ziemax-Repo/Avance/Codigo Analisis_v2.R",
    "project_path" : "Codigo Analisis_v2.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}