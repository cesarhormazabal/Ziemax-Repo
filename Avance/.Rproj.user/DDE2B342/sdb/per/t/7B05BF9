{
    "collab_server" : "",
    "contents" : "library(readxl)\nAccesibilidad<-read_excel(\"Accesibilidad.xls\")\nView(Accesibilidad)\nlibrary(readr)\nUbicacionGeografica2016 <- read_csv(\"UbicacionGeografica2016.csv\")\nView(UbicacionGeografica2016)\nlibrary(dplyr)\nColegios_Puntaje_2012 <- read_excel(\"Colegios.xls\", \n                       sheet = \"SIMCE IIM 2012 Leng\")\nColegios_Mat_Total <- read_excel(\"Colegios.xls\")\n\nColegios_Lideres <- read_excel(\"base datos redes final.xlsx\")\n\nColegios_Redes <- read_excel(\"base datos redes final.xlsx\", \n                                     sheet = \"Redes\")\n\nAccesibilidad%>% mutate(Comuna=toupper(Comuna))%>%mutate(Comuna=chartr(\"ÁÉÍÓÚ\",\"AEIOU\",Comuna))->Accesibilidad \n#Accesibilidad%>%group_by(Comuna)%>%summarise(conteo=n())%>%filter(conteo>1)\nUbicacionGeografica2016%>%mutate(NOM_COM_RBD=chartr(\"ÁÉÍÓÚ\",\"AEIOU\",NOM_COM_RBD))%>%left_join(Accesibilidad,by=c(\"NOM_COM_RBD\" = \"Comuna\"))->UbicacionGeografica2016\n\nColegios_Puntaje_2012%>%select(RBD,PROM_LECT,PROM_MAT)->Colegios_Puntaje_2012;View(Colegios_Puntaje_2012)\nColegios_Mat_Total[,c(1,3,5,17,18)]->Colegios_Mat_Total;View(Colegios_Mat_Total)\n\nUbicacionGeografica2016%>%left_join(Colegios_Puntaje_2012,by=\"RBD\")%>%left_join(Colegios_Mat_Total,by=\"RBD\")->Ubicacion_Actualizada\n\nlibrary(ggplot2)\nView(Ubicacion_Actualizada)\nnames(Ubicacion_Actualizada)\n\nnames(Ubicacion_Actualizada)%>%toupper()->names_data;\ngsub(\" \", \"\",chartr(\"ÁÉÍÓÚ\",\"AEIOU\",names_data) ,fixed = TRUE)->names(Ubicacion_Actualizada)\n#names(Ubicacion_Actualizada)\nnames(Ubicacion_Actualizada)[50]<-\"IMPLEMENTADO\"\n\n?select(Ubicacion_Actualizada, RBD,REGION,MAT_TOTAL,PROM_MAT,PROM_LECT,IMPLEMENTADO)\n\nUbicacion_Actualizada%>%group_by(NOM_COM_RBD)%>%summarise(Matricula_Comuna=sum(MAT_TOTAL,na.rm=TRUE))->Mat_Comuna\n\nUbicacion_Actualizada%>%group_by(RUT_SOSTENEDOR)%>%summarise(Matricula_Sostenedor=sum(MAT_TOTAL,na.rm=TRUE))->Mat_Sostenedor\n\nUbicacion_Actualizada%>%left_join(Colegios_Redes,by=\"RBD\")%>%mutate(Grupo=ifelse(is.na(Grupo),RUT_SOSTENEDOR,Grupo))%>%group_by(Grupo)%>%summarise(Matricula_Grupo=sum(MAT_TOTAL,na.rm=TRUE))->Mat_Grupo\nUbicacion_Actualizada%>%left_join(Colegios_Redes,by=\"RBD\")%>%mutate(Grupo=ifelse(is.na(Grupo),RUT_SOSTENEDOR,Grupo))->Ubicacion_Actualizada\nUbicacion_Actualizada%>%left_join(filter(Mat_Comuna,!is.na(Matricula_Comuna)),by=\"NOM_COM_RBD\")%>%left_join(Mat_Grupo,by=\"Grupo\")->Ubicacion_Actualizada;Ubicacion_Actualizada%>%View()    \n\n\n################# Cluster ##############################################\nnames(Ubicacion_Actualizada)\n\nselect(\n  Ubicacion_Actualizada,\n  RBD,\n  NOM_COM_RBD,\n  MAT_TOTAL,\n  Matricula_Comuna,\n  Matricula_Grupo,\n  GRADOACCESIBILIDAD,\n  PROM_LECT,\n  PROM_MAT\n)%>%filter(!is.na(MAT_TOTAL)) -> Result_1\n\nnames(Result_1)\n\n\nlibrary(data.table)\n\nset.seed(20)\nResult_1<-data.table(Result_1)\n\n\n\n?kmeans\ncomunas<-levels(as.factor(Result_1$NOM_COM_RBD))\n\ntablafinal<-data.frame(RBD=character(),\n                       NOM_COM_RBD=character(), \n                       MAT_TOTAL=numeric(), \n                       Matricula_Comuna=numeric(),\n                       Matricula_Grupo=numeric(),\n                       GRADOACCESIBILIDAD=numeric(),\n                       PROM_LECT=numeric(),\n                       PROM_MAT=numeric(),\n                       cluster=numeric(),\n                       stringsAsFactors=FALSE) \ncolnames(tablafinal)<-names(Result_1)\n\nfor(comuna in comunas)\n{\n  Result_1 %>% filter(comunas[1] == NOM_COM_RBD)-> Result_2\n  scale<-scale(Result_2[,c(\"Matricula_Grupo\",\n                           \"MAT_TOTAL\",\n                           \"PROM_LECT\",\n                           \"PROM_MAT\")])\n  cbind(Result_2[,\"GRADOACCESIBILIDAD\"],scale)->Result_2\n  Result_2[is.na(Result_2[,\"PROM_LECT\"]),\"PROM_LECT\"]<- median(Result_2[,\"PROM_LECT\"],na.rm=TRUE)\n  Result_2[is.na(Result_2[,\"PROM_MAT\"]),\"PROM_MAT\"]<- median(Result_2[,\"PROM_MAT\"],na.rm=TRUE)\n  \n  \n  Kmeans_comuna <- kmeans(Result_2[,c(\"Matricula_Grupo\",\n                                      \"MAT_TOTAL\",\n                                      \"PROM_LECT\",\n                                      \"PROM_MAT\",\n                                      \"GRADOACCESIBILIDAD\")],centers=5)\n  Result_2$cluster <-Kmeans_comuna$cluster\n  Result_1$cluster <-Result_2$cluster\n}\n\n\n\n",
    "created" : 1508355432987.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2948289768",
    "id" : "7B05BF9",
    "lastKnownWriteTime" : 1508365643,
    "last_content_update" : 1508365643525,
    "path" : "C:/Users/Stef/Desktop/Proyectos/ZIEMAX/Cesar Ziemax/Codigo Analisis.R",
    "project_path" : "Codigo Analisis.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}